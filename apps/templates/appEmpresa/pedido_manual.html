{% extends 'includes/side-nav.html' %}
{% load static %}
{% load my_filters %}
{% block title %}Criar Pedido{% endblock %}

{% block content2 %}
<!-- Incluir o CSS do Choices.js -->
<link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet" />

<!-- Incluir o JS do Choices.js -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<style>
    .choices {
    position: relative;
    margin-bottom: 24px;
    font-size: 16px
}

.choices:focus {
    outline: none
}

.choices:last-child {
    margin-bottom: 0
}

.choices.is-disabled .choices__inner,.choices.is-disabled .choices__input {
    background-color: #eaeaea;
    cursor: not-allowed;
    -webkit-user-select: none;
    -ms-user-select: none;
    -moz-user-select: none;
    user-select: none
}

.choices.is-disabled .choices__item {
    cursor: not-allowed
}

.choices [hidden] {
    display: none!important
}

.choices[data-type*=select-one] {
    cursor: pointer
}

.choices[data-type*=select-one] .choices__inner {
    padding-bottom: 7.5px
}

.choices[data-type*=select-one] .choices__input {
    display: block;
    width: 100%;
    padding: 10px;
    border-bottom: 1px solid #ddd;
    background-color: #fff;
    margin: 0
}

.choices[data-type*=select-one] .choices__button {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMjEiIHZpZXdCb3g9IjAgMCAyMSAyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0yLjU5Mi4wNDRsMTguMzY0IDE4LjM2NC0yLjU0OCAyLjU0OEwuMDQ0IDIuNTkyeiIvPjxwYXRoIGQ9Ik0wIDE4LjM2NEwxOC4zNjQgMGwyLjU0OCAyLjU0OEwyLjU0OCAyMC45MTJ6Ii8+PC9nPjwvc3ZnPg==);
    padding: 0;
    background-size: 8px;
    position: absolute;
    top: 50%;
    right: 0;
    margin-top: -10px;
    margin-right: 25px;
    height: 20px;
    width: 20px;
    border-radius: 10em;
    opacity: .5
}

.choices[data-type*=select-one] .choices__button:hover,.choices[data-type*=select-one] .choices__button:focus {
    opacity: 1
}

.choices[data-type*=select-one] .choices__button:focus {
    box-shadow: 0 0 0 2px #00bcd4
}

.choices[data-type*=select-one] .choices__item[data-value=""] .choices__button {
    display: none
}

.choices[data-type*=select-one]:after {
    content: "\f107";
    font: normal normal normal 14px/1 FontAwesome;
    position: absolute;
    right: 13.5px;
    top: 14px;
    pointer-events: none;
    transition: .3s ease
}

.choices[data-type*=select-one].is-open:after {
    transform: rotate(180deg)
}

.choices[data-type*=select-one][dir=rtl]:after {
    left: 11.5px;
    right: auto
}

.choices[data-type*=select-one][dir=rtl] .choices__button {
    right: auto;
    left: 0;
    margin-left: 25px;
    margin-right: 0
}

.choices[data-type*=select-multiple] .choices__inner,.choices[data-type*=text] .choices__inner {
    cursor: text
}

.choices[data-type*=select-multiple] .choices__button,.choices[data-type*=text] .choices__button {
    position: relative;
    display: inline-block;
    margin-top: 0;
    margin-right: -6px;
    margin-bottom: 0;
    margin-left: 8px;
    padding-left: 17px;
    border-left: 1px solid rgba(255,255,255,.3);
    background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMjEiIHZpZXdCb3g9IjAgMCAyMSAyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSIjRkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0yLjU5Mi4wNDRsMTguMzY0IDE4LjM2NC0yLjU0OCAyLjU0OEwuMDQ0IDIuNTkyeiIvPjxwYXRoIGQ9Ik0wIDE4LjM2NEwxOC4zNjQgMGwyLjU0OCAyLjU0OEwyLjU0OCAyMC45MTJ6Ii8+PC9nPjwvc3ZnPg==);
    background-size: 8px;
    width: 8px;
    line-height: 1;
    opacity: .75;
    border-radius: 0;
    transition: all .2s ease-in-out
}

.choices[data-type*=select-multiple] .choices__button:hover,.choices[data-type*=select-multiple] .choices__button:focus,.choices[data-type*=text] .choices__button:hover,.choices[data-type*=text] .choices__button:focus {
    opacity: 1
}

.choices__inner {
    display: flex;
    align-items: center;
    vertical-align: top;
    width: 100%;
    background-color: #fff;
    padding: .5rem .75rem;
    border: 1px solid #d2d6da;
    border-radius: .5rem;
    font-size: 14px;
    min-height: 40px;
    overflow: hidden
}

.is-focused .choices__inner,.is-open .choices__inner {
    border-color: #b7b7b7
}

.is-open .choices__inner {
    border-radius: 2.5px 2.5px 0 0
}

.is-flipped.is-open .choices__inner {
    border-radius: 0 0 2.5px 2.5px
}

.choices__list {
    margin: 0;
    padding-left: 0;
    list-style: none
}

.choices__list--single {
    display: inline-block;
    width: 100%
}

[dir=rtl] .choices__list--single {
    padding-right: 4px;
    padding-left: 16px
}

.choices__list--single .choices__item {
    width: 100%
}

.choices__list--multiple {
    display: inline
}

.choices__list--multiple .choices__item {
    display: inline-block;
    vertical-align: middle;
    border-radius: 20px;
    padding: 4px 10px;
    font-size: 12px;
    font-weight: 500;
    margin-right: 3.75px;
    margin-bottom: 3.75px;
    background-color: #212529;
    border: 1px solid #212529;
    color: #fff;
    word-break: break-all;
    box-sizing: border-box
}

.choices__list--multiple .choices__item[data-deletable] {
    padding-right: 5px
}

[dir=rtl] .choices__list--multiple .choices__item {
    margin-right: 0;
    margin-left: 3.75px
}

.choices__list--multiple .choices__item.is-highlighted {
    background-color: #00a5bb;
    border: 1px solid #008fa1
}

.is-disabled .choices__list--multiple .choices__item {
    background-color: #aaa;
    border: 1px solid #919191
}

.choices__list--dropdown {
    visibility: hidden;
    z-index: 1;
    position: absolute;
    width: 100%;
    background-color: #fff;
    border: 1px solid #ddd;
    top: 100%;
    margin-top: -1px;
    border-bottom-left-radius: 2.5px;
    border-bottom-right-radius: 2.5px;
    word-break: break-all;
    will-change: visibility
}

.choices__list--dropdown.is-active {
    visibility: visible
}

.is-open .choices__list--dropdown {
    border-color: #b7b7b7
}

.is-flipped .choices__list--dropdown {
    top: auto;
    bottom: 200%;
    margin-top: 0;
    margin-bottom: -1px;
    border-radius: .5rem
}

.choices__list--dropdown .choices__list {
    position: relative;
    max-height: 300px;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    will-change: scroll-position
}

.choices__list--dropdown .choices__item {
    position: relative;
    padding: .3rem 1rem;
    font-size: .875rem;
    border-radius: .5rem;
    transition: background-color .3s ease,color .3s ease
}

[dir=rtl] .choices__list--dropdown .choices__item {
    text-align: right
}

@media(min-width: 640px) {
    .choices__list--dropdown .choices__item--selectable {
        padding-right:100px
    }

    .choices__list--dropdown .choices__item--selectable:after {
        content: attr(data-select-text);
        font-size: 12px;
        opacity: 0;
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        transition: opacity .3s ease
    }

    [dir=rtl] .choices__list--dropdown .choices__item--selectable {
        text-align: right;
        padding-left: 100px;
        padding-right: 10px
    }

    [dir=rtl] .choices__list--dropdown .choices__item--selectable:after {
        right: auto;
        left: 10px
    }
}

.choices__list--dropdown .choices__item--selectable.is-highlighted {
    background-color: #f2f2f2
}

.choices__list--dropdown .choices__item--selectable.is-highlighted:after {
    opacity: .5
}

.choices__item {
    cursor: default
}

.choices__item--selectable {
    cursor: pointer
}

.choices__item--disabled {
    cursor: not-allowed;
    -webkit-user-select: none;
    -ms-user-select: none;
    -moz-user-select: none;
    user-select: none;
    opacity: .5
}

.choices__heading {
    font-weight: 600;
    font-size: 12px;
    padding: 10px;
    border-bottom: 1px solid #f7f7f7;
    color: gray
}

.choices__button {
    text-indent: -9999px;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: 0;
    background-color: transparent;
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer
}

.choices__button:focus {
    outline: none
}

.choices__input {
    display: inline-block;
    vertical-align: baseline;
    background-color: #fff;
    font-size: 14px;
    margin-bottom: 5px;
    border: 0;
    border-radius: 0;
    max-width: 100%;
    padding: 4px 0 4px 2px
}

.choices__input:focus {
    outline: 0
}

[dir=rtl] .choices__input {
    padding-right: 2px;
    padding-left: 0
}

.choices__placeholder {
    opacity: .5
}

.is-open .choices__inner {
    border-radius: .5rem
}

.choices__list--dropdown {
    display: block;
    opacity: 0;
    top: 19px;
    transform-origin: 50% 0;
    pointer-events: none;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    will-change: transform,box-shadow;
    border: none;
    border-radius: .5rem;
    box-shadow: 0 8px 26px -4px rgba(20,20,20,.15),0 8px 9px -5px rgba(20,20,20,.06);
    transform: perspective(999px) rotateX(-10deg) translateZ(0) translate3d(0px,37px,0px)!important;
    padding: 1rem .5rem;
    transition: visibility .25s,opacity .25s,transform .25s
}

.choices__list--dropdown.is-active {
    transform: perspective(999px) rotateX(0deg) translateZ(0) translate3d(0,37px,5px)!important;
    opacity: 1;
    display: block;
    pointer-events: auto
}

.choices__list--dropdown.is-active:before {
    top: -20px
}

.choices__list--dropdown:before {
    font-family: fontawesome;
    content: "\f0d8";
    position: absolute;
    top: 0;
    left: 28px;
    right: auto;
    font-size: 22px;
    color: #fff;
    transition: top .35s ease
}

.choices[data-type*=select-one] .choices__input {
    border-bottom-color: #f8f9fa
}

.choices__list--dropdown .choices__item--selectable.is-highlighted {
    background: #e9ecef;
    color: #344767
}

.is-focused .choices__inner,.is-open .choices__inner {
    box-shadow: 0 3px 9px transparent,3px 4px 8px rgba(94,114,228,.1);
    border-color: #fb6340
}

.choices-primary {
    background-color: #fb6340
}

.choices-secondary {
    background-color: #8392ab
}

.choices-success {
    background-color: #2dce89
}

.choices-info {
    background-color: #11cdef
}

.choices-warning {
    background-color: #fb6340
}

.choices-danger {
    background-color: #f5365c
}

.choices-light {
    background-color: #e9ecef
}

.choices-dark {
    background-color: #212529
}

.choices-white {
    background-color: #fff
}

#completed-tasks label {
    text-decoration: line-through;
    color: #888
}

ul li input[type=text] {
    display: none
}

ul li.editMode input[type=text] {
    display: block
}

ul li.editMode label {
    display: none
}
</style>
<link rel="stylesheet" href="{% static 'css/3steps.css' %}">
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h3 class="mt-5">Faça um Pedido Manual</h3>
            <h5 class="font-weight-normal">Preencha as informações abaixo para registrar um pedido manual em nosso sistema.</h5>
            <div class="multisteps-form mb-5">
                <!--progress bar-->
                <div class="row mt-5">
                    <div class="col-12 col-lg-8 mx-auto my-5">
                        <div class="multisteps-form__progress">
                            <button class="multisteps-form__progress-btn js-active" type="button" title="User Info">
                                <span>Cardápio</span>
                            </button>
                            <button class="multisteps-form__progress-btn" type="button" title="Address">
                                <span>Cliente</span>
                            </button>
                            <button class="multisteps-form__progress-btn" type="button" title="Order Info">
                                <span>Resumo</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!--form panels-->
                <div class="row">
                    <div class="col-12 col-lg-8 m-auto">
                        <form method="post" action="#" class="multisteps-form__form needs-validation" style="min-height: 520px;" novalidate>
                            {% csrf_token %}
                            <!--single form panel-->
                            <div class="card multisteps-form__panel p-3 border-radius-xl bg-white js-active" data-animation="FadeIn">
                                <div class="row text-center">
                                    <div class="col-10 mx-auto">
                                        <h5 class="font-weight-normal">Vamos começar com as informações básicas do pedido.</h5>
                                        <p>Nos informe qual pizza do nosso cardápio você deseja pedir. Abaixo está a lista de opções disponíveis.</p>
                                    </div>
                                </div>
                                <div class="multisteps-form__content">
                                    <div class="row mt-3">
                                        <div class="col-12 col-sm-8 mt-4 mt-sm-0 text-start">
                                            <!-- Início do Pedido Dinâmico -->
                                            <h5>Adicione itens ao seu pedido:</h5>
                                
                                            <!-- Dropdown para escolher a pizza -->
                                            <div class="input-group input-group-outline position-relative w-lg-80 mb-3">
                                                <select class="form-control" id="pizzaSelect" name="pizza">
                                                    <option value="" disabled selected>Escolha uma pizza...</option>
                                                    {% for cardapio in cardapios %}
                                                        <option value="{{ cardapio.id_cardapio }}" data-img="{{ cardapio.imagem.url }}">{{ cardapio.nome }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                
                                            <!-- Campo de quantidade -->
                                            <div class="input-group input-group-outline position-relative w-lg-80 mb-3">
                                                <input type="number" class="form-control" id="quantidade" name="quantidade" min="1" placeholder="Quantidade" value="1">
                                            </div>
                                
                                            <!-- Botão para adicionar item ao pedido -->
                                            <button class="btn bg-gradient-dark" type="button" id="addItemButton">Adicionar ao Pedido</button>
                                
                                            <!-- Lista de itens adicionados ao pedido -->
                                            <h5 class="mt-4">Itens no Pedido:</h5>
                                            <ul id="pedidoList" class="list-group">
                                                <!-- Itens serão adicionados aqui -->
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="button-row d-flex mt-4">
                                        <button class="btn bg-gradient-dark ms-auto mb-0 js-btn-next" type="button" title="Next">Próximo</button>
                                    </div>
                                </div>
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
    const addItemButton = document.getElementById('addItemButton');
    const pizzaSelect = document.getElementById('pizzaSelect');
    const quantidadeInput = document.getElementById('quantidade');
    const pedidoList = document.getElementById('pedidoList');

    addItemButton.addEventListener('click', function () {
        const pizzaId = pizzaSelect.value;
        const pizzaName = pizzaSelect.options[pizzaSelect.selectedIndex].text;
        const quantidade = quantidadeInput.value;

        if (pizzaId && quantidade > 0) {
            // Adicionar o item à lista do pedido
            const itemList = document.createElement('li');
            itemList.classList.add('list-group-item');
            itemList.innerHTML = `${pizzaName} - Quantidade: ${quantidade} <button class="btn btn-sm btn-danger float-end remove-item" type="button">Remover</button>`;

            // Adicionar o item à lista visual
            pedidoList.appendChild(itemList);

            // Limpar os campos para novo item
            pizzaSelect.value = "";
            quantidadeInput.value = 1;
        } else {
            alert('Por favor, selecione uma pizza e informe a quantidade.');
        }
    });

    // Evento de remover item da lista de pedidos
    pedidoList.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('remove-item')) {
            const item = e.target.closest('li');
            item.remove();
        }
    });
});

                            </script>                                
                                
                                
                            </div>
                            <!--single form panel-->
                            <div class="card multisteps-form__panel p-3 border-radius-xl bg-white" data-animation="FadeIn">
                                <div class="row text-center">
                                    <div class="col-10 mx-auto">
                                        <h5 class="font-weight-normal">Quais ingredientes?</h5>
                                        <p>Nos de mais detalhes. Como é feito esse item do cardápio?
                                        </p>
                                    </div>
                                </div>
                                <div class="multisteps-form__content">
                                    <div class="row mt-4">
                                        {% for ingrediente in ingredientes %}
                                            <div class="col-sm-3 mb-3">
                                                <!-- Checkbox escondido -->
                                                <input type="checkbox" class="btn-check" id="checkbox_{{ ingrediente.id_ingrediente }}" name="ingredientes" value="{{ ingrediente.id_ingrediente }}" data-unidade="{{ingrediente.unidade}}">
                                    
                                                <!-- Botão estilizado -->
                                                <label class="btn btn-outline-secondary w-100 py-4 px-4 rounded-3 d-flex align-items-center justify-content-center" style="height: 60px;" for="checkbox_{{ ingrediente.id_ingrediente }}">
                                                    <span class="text-center">{{ ingrediente.nome }}</span>
                                                </label>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    <div class="button-row d-flex mt-4">
                                        <button class="btn bg-gradient-light mb-0 js-btn-prev" type="button" title="Prev">Anterior</button>
                                        <button class="btn bg-gradient-dark ms-auto mb-0 js-btn-next" type="button" title="Next">Proxima</button>
                                    </div>
                                </div>
                            </div>
                            <!--single form panel-->
                            <div class="card multisteps-form__panel p-3 border-radius-xl bg-white" data-animation="FadeIn">
                                <div class="row text-center">
                                    <div class="col-10 mx-auto">
                                        <h5 class="font-weight-normal">Qual a quantidade?</h5>
                                        <p>Qual quantidade de cada ingrediente é usado nessa receita?</p>
                                    </div>
                                </div>
                                <div class="multisteps-form__content">
                                    <div class="row text-start" id="quantidade-ingredientes">
                                        <p class="text-center text-danger">Selecione os ingredientes para escolher a quantidade.</p>
                                    </div>
                                    <div class="row">
                                        <div class="button-row d-flex mt-4 col-12">
                                            <button class="btn bg-gradient-light mb-0 js-btn-prev" type="button" title="Prev">Anterior</button>
                                            <button class="btn bg-gradient-dark ms-auto mb-0" type="submit" title="Send">Enviar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'js/3steps.js' %}"></script>
{% endblock %}